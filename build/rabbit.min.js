/*
 *@name     Rabbit
 *@version  
 *@desc     An Extremely Simple MVC Library used for SPA.
 *@author   VeeQun
 *@license  MIT
 *@modified 2014-05-22
 */
!function(a){function b(a,b){var c=new d(b);c.createDependcies(a,this).load()}function c(a,b){b||"function"==typeof a&&(b=a,a=[]),"function"!=typeof b&&(b=h),c.handler=b,c.dependModules=a,c.scope=this}function d(a){var b=a.toString(),c=e(b);return p[c]?p[c].module:(this.url=0==b.indexOf("function")?"":b,this.id=c,this.status=l,this.dependeds=[],this.dependModules=[],this.dependencies=0,this.handler="function"==typeof a?a:null,void(p[this.id]={module:this,exports:null}))}function e(a){return 0==a.indexOf("function")?"rabbit_anonymous_"+Math.random().toString(32).slice(2):"rabbit_"+a.replace(/\/|\\/g,"_")}function f(a){var c=b.config.host+b.config.baseUrl+"/"+a.url+".js",d=g(a);d.load(c)}function g(a){function b(){a.handler=c.handler;var b=c.dependModules,d=c.scope;a.createDependcies(b,d),c.handler=null,c.dependModules=null,c.scope=null,a.status=n,a.check(),f.parentNode.removeChild(f)}function d(){throw new Error("Failed to load resource: "+a.url)}function e(){/complete|loaded/.test(this.readyState)&&b()}var f=document.createElement("script");f.type="text/javascript",f.async=!0,f.defer=!0,"onload"in f?(f.onload=b,f.onerror=d):f.onreadystatechange=e;var g={load:function(a){f.src=a,k?j.inserBefore(f,k):j.appendChild(f)}};return g}var h=function(){},i=Array.prototype.push,j=document.getElementsByTagName("head")[0],k=j.getElementsByTagName("base")[0],l=0,m=1,n=2,o=3,p={};b.config={host:"/",baseUrl:""},d.prototype.createDependcies=function(a,b){a=[].concat(a),i.apply(this.dependModules,a),this.scope=b||null;for(var c=null,e=0,f=a.length;f>e;++e)++this.dependencies,c=new d(a[e]),c.depended([this]).load();return this},d.prototype.load=function(){return this.status==o?this.notice():this.status==n?this.check():this.status==m?this.status:(this.url&&f(this),this.status=m)},d.prototype.check=function(){return 0==this.dependencies?this.execute():void 0},d.prototype.step=function(){return--this.dependencies,this},d.prototype.execute=function(){for(var a,b=[],c=this.dependModules,d=0,f=c.length;f>d;++d)(a=p[e(c[d])])&&b.push(a.exports);return this.handler&&(p[this.id].exports=this.handler.apply(this.scope,b)),this.notice(),this.status=o},d.prototype.notice=function(){for(var a=this.dependeds.length;a;)this.dependeds[--a].step().check()},d.prototype.depended=function(a){return i.apply(this.dependeds,a),this},a.require=b,a.define=c}(this),function(Global){var Base={};Base.create=function(a){function b(){}function c(a){for(var b in a)this[b]=a[b]}return a=a||{},b.prototype=a,b.prototype.extend=c,new b},Base.Class=function(a,b){function c(a){for(var b in a)this[b]=a[b]}b||(b=a||{},a=function(){});var d=function(){};d.prototype=a.prototype||{};var e=function(){var c=this;this.supper=a,"function"==typeof b.__constructor__&&b.__constructor__.apply(c,arguments),"function"==typeof b.__propertys__&&b.__propertys__.apply(c,arguments),"function"==typeof b.__init__&&b.__init__.apply(c,arguments)};return e.prototype=new d,e.extend=c,e.prototype.extend=c,e.fn=e.prototype,e.prototype.proxy=function(a){var b=this;return function(){a.apply(b,arguments)}},e},Base.Utils=Base.create(),Base.Utils.extend({JSON:Global.JSON||{parse:function(jsonString){var ret=null;return eval("ret=("+jsonString+")"),ret},stringify:function(a){function b(a){var b=Object.prototype.toString.call(a).slice(8,-1);switch(b){case"String":return'"'+a.toString()+'"';case"Date":return'"'+(a.toJSON?a.toJSON():e(a))+'"';case"Array":return d(a);case"Object":return c(a);case"Function":case"Undefined":return"null";default:return a.toString()}}function c(a){var c=[];for(var d in a)c.push('"'+d+'":'+b(a[d]));return"{"+c.join(",")+"}"}function d(a){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d]));return"["+c.join(",")+"]"}function e(a){function b(a){return 10>a?"0"+a:a}return isFinite(a.valueOf())?a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z":null}return b(a)}},queryToJson:function(a){var b="{"+a.replace(/\&/g,",").replace(/\=/g,":").replace(/(\w+)/gim,'"$1"')+"}";return b&&this.JSON.parse(b)},clear:function(a){return a.replace(/[\t\r\n\s]/gm,"")},is:function(){var a=Object.prototype.toString;return function(b,c){var d=a.call(b).slice(8,-1);return d.toLowerCase()==c.toLowerCase()}}()}),Global.Rabbit=Base}(this),function(a,b){var c=b.Utils.JSON,d=b.Utils.is,e=new b.Class({__constructor__:function(){this.name},__propertys__:function(a){this.name=a.name},__init__:function(){localStorage.setItem(this.name,"")}});e.fn.extend({get:function(){return c.parse(localStorage.getItem(this.name))},set:function(a){var b=this.get();if(d(b,"array"))b=b.concat(a);else for(var e in a)b[e]=a[e];localStorage.setItem(this.name,c.stringify(b))}}),b.Model=e}(this,Rabbit),function(a,b){var c=b.Utils.is,d=new b.Class({__constructor__:function(){this.isCreated},__propertys__:function(){this.isCreated=!1},__init__:function(a){if(!c(a,"object"))return!1;for(var b in a)this[b]=a[b]}});d.fn.extend({onCreate:function(){},onLoad:function(){},onShow:function(){},onHide:function(){},start:function(){}}),b.View=d}(this,Rabbit),function(a,b){var c=new b.Class({__constructor__:function(a){this.router={},this.currentView="",this.config={VIEW_HOST:a.VIEW_HOST||"/",VIEW_BASE:a.VIEW_BASE||"",VIEW_DEFAULT:"index",MAIN_CONTAINER:a.MAIN_CONTAINER||document.body}},__init__:function(){require.config={host:this.config.VIEW_HOST,baseUrl:this.config.VIEW_BASE},this.hashChange(),a.onhashchange=this.proxy(this.hashChange)}});c.fn.extend({hashChange:function(){var a=this.getViewInfo();this.switchView(a)},switchView:function(a){function c(c){f.view=c,c.param=b.Utils.queryToJson(a.query),this.create(c,e),this.render(c),this.viewLoaded(c)}var d=null,e=a.path,f=this.router[e]||(this.router[e]={});return(d=f.view)?(d.param=b.Utils.queryToJson(a.query),this.viewLoaded(d)):require(e,this.proxy(c)),!0},create:function(a,b){var c=this.createContainer();b.container=c.container,b.id=c.id,a.el=c.container,a.viewID=c.id,a.onCreate()},render:function(a){this.config.MAIN_CONTAINER.appendChild(a.el)},viewLoaded:function(a){a.onLoad(),this.swapView(a),a.start()},swapView:function(a){var b;(b=this.currentView)&&!!(b.el.style.display="none")&&b.onHide(),this.currentView=a,a.el.style.display="",a.onShow()},getViewInfo:function(){var a=location.hash.split("?");return{path:(a[0]||"#"+this.config.VIEW_DEFAULT).replace("#","/"),query:a[1]||""}},getViewUri:function(a){return this.config.VIEW_HOST+this.config.VIEW_BASE+a},createContainer:function(){var a=0,b="rabbit-view-";return function(){var c=document.createElement("div"),d=b+ ++a;return c.id=d,c.style.display="none",{container:c,id:d}}}()}),b.Controller=c}(this,Rabbit);